<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Biblioteca</title>
  </head>
  <body>
    <h1>Cadastro de Livro</h1>
    <form id="form">
      <label for="titulo">Título:</label>
      <input
        type="text"
        id="titulo"
        placeholder="Digite o título do livro"
      /><br />

      <label for="autor">Autor:</label>
      <input
        type="text"
        id="autor"
        placeholder="Digite o nome do autor"
      /><br />

      <label for="isbn">ISBN:</label>
      <input
        type="number"
        id="isbn"
        placeholder="Digite o ISBN do livro"
      /><br />

      <button type="button" onclick="enviar()">Enviar</button>
    </form>
    <h2>Lista de Livros</h2>
    <ul id="lista"></ul>
    <body onload="Lista()">

    <script>
      async function enviar() {
        const livro = {
          titulo: document.getElementById("titulo").value,
          autor: document.getElementById("autor").value,
          isbn: document.getElementById("isbn").value,
        };
        try {
          const resposta = await fetch("http://localhost:8080/livros", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(livro),
          });
          if (resposta.ok) {
            alert("Livro cadastrado");
            document.getElementById("form").reset();
          } else {
            alert("Erro ao cadastrar o Livro");
          }
        } catch (erro) {
          console.log("Erro", erro);
        }
      }

      async function Lista() {
        try {
          const resposta = await fetch("http://localhost:8080/livros");
          const livros = await resposta.json();

          const lista = document.getElementById("lista");
          lista.innerText = "";

          livros.forEach((livro) => {
            const item = document.createElement("li");
            item.textContent = `${livro.titulo} ${livro.autor} ${livro.isbn}`;
            lista.appendChild(item);
          });
        } catch (erro) {
          console.log("Erro ao carregar");
        }
      }
    </script>
  </body>
</html>
